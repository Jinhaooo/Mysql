# 从数据页的角度看B+树
## InnoDB是怎么存储数据的？
InnoDB的数据是按数据页为单位读写的。InnoDB 数据页的默认大小是 16KB。  
数据页的结构如下：  
<img width="692" height="843" alt="image" src="https://github.com/user-attachments/assets/f7651ec4-a2d3-4059-b931-042377c0f9e2" />  
七个部分的作用如下：  
<img width="962" height="602" alt="image" src="https://github.com/user-attachments/assets/7aa4c60f-408c-4fd7-8c54-4b50e385af53" />  
在 File Header 中有两个指针，分别指向上一个数据页和下一个数据页，连接起来的页相当于一个双向的链表，如下图所示：  
<img width="1080" height="430" alt="image" src="https://github.com/user-attachments/assets/fb5be323-7171-4f7e-9ca1-50d604b6e89b" />  
采用链表的结构是让数据页之间不需要是物理上的连续的，而是逻辑上的连续。  
数据页的主要作用是存储记录，也就是数据库的数据，所以接下来来看User records是怎么组织数据的。  
数据页中的记录按照「主键」顺序组成单向链表，单向链表的特点就是插入、删除非常方便，但是检索效率不高，最差的情况下需要遍历链表上的所有节点才能完成检索。  
因此，数据页中有一个页目录，起到记录的索引作用，结构如下：  
<img width="1080" height="1228" alt="image" src="https://github.com/user-attachments/assets/799e4f64-b359-44f8-96c1-204a47ff6a61" />
页目录创建的过程如下：  
将所有的记录划分成几个组，这些记录包括最小记录和最大记录，但不包括标记为“已删除”的记录；  
每个记录组的最后一条记录就是组内最大的那条记录，并且最后一条记录的头信息中会存储该组一共有多少条记录，作为 n_owned 字段（上图中粉红色字段）。  
页目录用来存储每组最后一条记录的地址偏移量，这些地址偏移量会按照先后顺序存储起来，每组的地址偏移量也被称之为槽（slot），每个槽相当于指针指向了不同组的最后一个记录。  
从图可以看到，页目录就是由多个槽组成的，槽相当于分组记录的索引。所以我们通过槽查找记录时，可以使用二分法快速定位要查询的记录在哪个槽（哪个记录分组），定位到槽后，再遍历槽内的所有记录，找到对应的记录，无需从最小记录开始遍历整个页中的记录链表。  



